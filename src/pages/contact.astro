---
import MainLayout from '../layouts/MainLayout.astro';
import Header from '../components/Header';
import Footer from '../components/Footer';
import RevealOnScroll from '../components/RevealOnScroll';
import ContactDetail from '../components/ContactDetail';
---

<MainLayout
  title="Contact - Praesio | Gestion d'Installations de Luxe Paris"
  description="Contactez Praesio pour vos besoins en gestion d'installations haut de gamme. Notre équipe est disponible 24/7 pour répondre à vos demandes. Bureau Paris 16ème."
  canonical="/contact"
>
  <div class="relative flex h-auto min-h-screen w-full flex-col overflow-x-hidden bg-background-dark">
    <Header client:load />
    <main class="flex-grow flex flex-col">
      <div class="pt-32 lg:pt-48 pb-0 px-0 w-full min-h-screen flex flex-col">
        <div class="px-6 lg:px-20 max-w-[1600px] mx-auto w-full mb-24">
          <div class="grid grid-cols-1 lg:grid-cols-12 gap-16 lg:gap-32 items-start">
            <!-- Left Column: Heading & Info -->
            <div class="lg:col-span-5 flex flex-col gap-16 lg:sticky lg:top-40">
              <RevealOnScroll client:visible>
                <div class="space-y-8">
                  <span class="text-primary text-xs tracking-[0.2em] uppercase font-light pl-4 font-body border-l-2 border-primary">Contactez-nous</span>
                  <h2 class="text-h1 text-text-main font-serif  leading-[1.1]">
                    Contacter <br /> <span class="text-primary italic">Praesio</span>
                  </h2>
                  <p class="text-text-body font-light text-body leading-relaxed max-w-md mt-6 font-body">
                    Solutions de gestion d'installations de prestige adaptées aux environnements les plus exigeants.
                  </p>
                </div>
              </RevealOnScroll>

              <!-- Contact Details Block - Charcoal #1E293B -->
              <RevealOnScroll client:visible delay={200}>
                <div class="bg-card-dark p-12 space-y-12 border border-white/5 shadow-none">
                  <ContactDetail
                    label="Courrier Électronique"
                    value="contact@praesio.com"
                    link="mailto:contact@praesio.com"
                    icon="arrow_outward"
                  />
                  <div class="space-y-3">
                    <p class="text-primary text-xs uppercase tracking-widest mb-1 font-body font-light ">Bureau</p>
                    <address class="text-text-main text-xl font-light tracking-wide not-italic leading-relaxed font-body">
                      27 Rue Raffet<br />75016 Paris
                    </address>
                  </div>
                </div>
              </RevealOnScroll>
            </div>

            <!-- Right Column: Form - Deep Blue #0F172A -->
            <div class="lg:col-span-7 w-full bg-surface-dark p-10 md:p-16 relative overflow-hidden border border-white/5 rounded-none">
              <RevealOnScroll client:visible delay={300}>
                <form class="flex flex-col gap-12 relative z-10" id="contact-form">
                  <!-- Web3Forms Access Key -->
                  <input type="hidden" name="access_key" value="ecdf08ee-0313-41d5-803f-0ba5b1de22ad" />

                  <!-- Honeypot Spam Protection -->
                  <input type="checkbox" name="botcheck" class="hidden" style="display: none;" />

                  <div class="grid grid-cols-1 md:grid-cols-2 gap-12">
                    <div class="flex flex-col gap-4 group">
                      <span class="text-text-body text-xs uppercase tracking-widest group-focus-within:text-primary transition-colors font-body font-light ">Nom Complet</span>
                      <input
                        required
                        name="name"
                        class="w-full bg-card-dark border-b border-primary/30 text-text-main py-4 px-4 focus:outline-none focus:border-primary focus:bg-[#253045] transition-colors placeholder:text-text-body/20 font-light text-lg rounded-none font-body"
                        placeholder="Jean Dupont"
                        type="text"
                      />
                    </div>
                    <div class="flex flex-col gap-4 group">
                      <span class="text-text-body text-xs uppercase tracking-widest group-focus-within:text-primary transition-colors font-body font-light ">E-mail Professionnel</span>
                      <input
                        required
                        name="email"
                        class="w-full bg-card-dark border-b border-primary/30 text-text-main py-4 px-4 focus:outline-none focus:border-primary focus:bg-[#253045] transition-colors placeholder:text-text-body/20 font-light text-lg rounded-none font-body"
                        placeholder="jean@entreprise.com"
                        type="email"
                      />
                    </div>
                  </div>

                  <div class="flex flex-col gap-4 group mt-2">
                    <span class="text-text-body text-xs uppercase tracking-widest group-focus-within:text-primary transition-colors font-body font-light ">Sujet de l'e-mail</span>
                    <input
                      required
                      name="subject"
                      class="w-full bg-card-dark border-b border-primary/30 text-text-main py-4 px-4 focus:outline-none focus:border-primary focus:bg-[#253045] transition-colors placeholder:text-text-body/20 font-light text-lg rounded-none font-body"
                      placeholder="Demande de renseignements"
                      type="text"
                    />
                  </div>

                  <div class="flex flex-col gap-4 group mt-2">
                    <span class="text-text-body text-xs uppercase tracking-widest group-focus-within:text-primary transition-colors font-body font-light ">Message</span>
                    <textarea
                      required
                      name="message"
                      class="w-full bg-card-dark border-b border-primary/30 text-text-main py-4 px-4 focus:outline-none focus:border-primary focus:bg-[#253045] transition-colors placeholder:text-text-body/20 font-light text-lg min-h-[200px] resize-none rounded-none font-body"
                      placeholder="Veuillez décrire vos besoins..."
                    ></textarea>
                  </div>

                  <!-- Status Message -->
                  <div id="form-message" class="hidden p-4 rounded-none border font-body font-light text-sm"></div>

                  <div class="pt-8 flex justify-start">
                    <button
                      type="submit"
                      id="submit-btn"
                      class="group relative px-12 py-5 bg-primary text-background-dark tracking-widest uppercase text-xs overflow-hidden transition-colors hover:bg-white hover:text-background-dark font-body font-light rounded-none disabled:opacity-50 disabled:cursor-not-allowed"
                    >
                      <span class="relative z-10" id="btn-text">Envoyer la demande</span>
                    </button>
                  </div>
                </form>
              </RevealOnScroll>
            </div>
          </div>
        </div>

        <!-- Footer Image -->
        <RevealOnScroll client:visible delay={100}>
          <div class="w-full h-[60vh] relative overflow-hidden group">
            <div class="absolute inset-0 bg-background-dark/20 z-10 group-hover:bg-background-dark/10 transition-colors duration-700"></div>
            <img
              src="images/Escalators.webp"
              alt="Praesio Office Environment"
              class="w-full h-full object-cover object-center grayscale-[30%] contrast-110 transition-transform duration-[2s] group-hover:scale-105"
            />
            <!-- Subtle overlay gradient from bottom to blend with footer if needed, though footer has its own top border -->
            <div class="absolute bottom-0 left-0 w-full h-32 bg-gradient-to-t from-background-dark to-transparent z-20 opacity-80"></div>
          </div>
        </RevealOnScroll>
      </div>
    </main>
    <Footer client:load />
  </div>

  <!-- Structured Data pour la page Contact -->
  <script type="application/ld+json" is:inline>
    {
      "@context": "https://schema.org",
      "@type": "ContactPage",
      "name": "Contact Praesio",
      "description": "Contactez Praesio pour vos besoins en gestion d'installations de luxe",
      "url": "https://praesio.com/contact",
      "mainEntity": {
        "@type": "Organization",
        "name": "Praesio",
        "email": "contact@praesio.com",
        "address": {
          "@type": "PostalAddress",
          "streetAddress": "27 Rue Raffet",
          "addressLocality": "Paris",
          "postalCode": "75016",
          "addressCountry": "FR"
        }
      }
    }
  </script>
</MainLayout>

<script>
  // Scroll to top on page load
  window.scrollTo(0, 0);

  // Handle form submission with Web3Forms
  const form = document.getElementById('contact-form') as HTMLFormElement;
  const submitBtn = document.getElementById('submit-btn') as HTMLButtonElement;
  const btnText = document.getElementById('btn-text') as HTMLSpanElement;
  const formMessage = document.getElementById('form-message') as HTMLDivElement;

  if (form) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();

      // Disable button and show loading state
      submitBtn.disabled = true;
      btnText.textContent = 'Envoi en cours...';
      formMessage.classList.add('hidden');

      // Get form data
      const formData = new FormData(form);
      const object = Object.fromEntries(formData);
      const json = JSON.stringify(object);

      try {
        const response = await fetch('https://api.web3forms.com/submit', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: json
        });

        const result = await response.json();

        if (response.ok && result.success) {
          // Success
          formMessage.classList.remove('hidden', 'border-red-500', 'bg-red-500/10', 'text-red-400');
          formMessage.classList.add('border-primary', 'bg-primary/10', 'text-primary');
          formMessage.textContent = 'Votre demande a été envoyée avec succès. Un représentant Praesio vous contactera prochainement.';

          // Reset form
          form.reset();

          // Reset button after 3 seconds
          setTimeout(() => {
            btnText.textContent = 'Envoyer la demande';
            submitBtn.disabled = false;
          }, 3000);
        } else {
          throw new Error(result.message || 'Une erreur est survenue');
        }
      } catch (error) {
        // Error
        formMessage.classList.remove('hidden', 'border-primary', 'bg-primary/10', 'text-primary');
        formMessage.classList.add('border-red-500', 'bg-red-500/10', 'text-red-400');
        formMessage.textContent = 'Une erreur est survenue lors de l\'envoi. Veuillez réessayer ou nous contacter directement par email.';

        // Reset button
        btnText.textContent = 'Envoyer la demande';
        submitBtn.disabled = false;
      }
    });
  }
</script>
